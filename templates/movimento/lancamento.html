{# templates/movimento/lancamento.html #}
{% extends "base.html" %}

{% block title %}Finanças | {{ title }}{% endblock %}
{% block header_title %}{{ title }}{% endblock %}

{% block content %}
<h2>Registrar Novo Lançamento</h2>

<form action="{{ url_for('movimento.mov_lancamento') }}" method="post">
    <label for="conta_id">Conta Bancária:</label>
    <select id="conta_id" name="conta_id" required>
        <option value="">Selecione a Conta</option>
        {% for conta in contas %}
        <option value="{{ conta.id }}">{{ conta.nome_banco }} - {{ conta.numero_conta }} (Saldo: R$ {{ "%.2f" %
            conta.saldo_atual }})</option>
        {% endfor %}
    </select><br><br>

    <label for="data">Data:</label>
    {# REMOVA {{ today_date() }} daqui! Deixe o JavaScript preencher. #}
    <input type="date" id="data" name="data" required><br><br>

    <label for="valor">Valor (Positivo para receita, Negativo para despesa):</label>
    <input type="text" id="valor" name="valor" step="0.01" required placeholder="Ex: 100.50 ou -50.25"><br><br>

    <label for="descricao">Descrição:</label>
    <input type="text" id="descricao" name="descricao" required><br><br>

    <button type="submit" class="button">Salvar Lançamento</button>
    <a href="{{ url_for('movimento.index') }}" class="button cancel">Cancelar</a>
</form>

{% endblock %}

{% block scripts_extra %}
<script>
    function today_date_js() {
        const today = new Date();
        const year = today.getFullYear();
        let month = today.getMonth() + 1;
        let day = today.getDate();

        if (day < 10) day = '0' + day;
        if (month < 10) month = '0' + month;

        return year + '-' + month + '-' + day;
    }
    document.addEventListener('DOMContentLoaded', (event) => {
        const dateInput = document.getElementById('data');
        if (dateInput) {
            dateInput.value = today_date_js();
        }
    });
</script>
{% endblock %}